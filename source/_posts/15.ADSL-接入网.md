---
title: ADSL 接入网
date: 2022-03-13 13:38:19
author: Rayd62
tags:
  - 读书笔记
  - 网络技术
  - 网络是怎样连接的
---

# ADSL 接入网
## ADSL 接入网的构成（组件）
![ADSL 接入网结构（PPPoE 方式）](https://cdn.jsdelivr.net/gh/Rayd62/note_images/202203111824661.png)
## 用户侧
在整个网络连接的过程中，用户侧是上图中最右侧的部分，包含了：
+ 用户计算机
+ 互联网接入路由器
+ ADSL Modem（调制解调器）
+ 分离器
+ 电话机

### 各组件的功能
#### 互联网接入路由器
提供拨号上网、NAT和路由的功能。

#### ADSL Modem（调制解调器）
##### ADSL Modem 做了什么
将路由器传输过来的以太网帧拆分为信元，并将信元调制成电信号传输到局端多路Modem。

##### 什么是信元
ATM 交换和多路复用的基本单位，由信头和信息段组成，信头中装有控制信息，信息段中装入被分解成数据块的用户信息或其他管理信息。
<table>
    <thead>
    <tr>
        <th colspan="3"> 信元的构造</th>
    </tr>
            <tr>
             <td>Component</td>
             <td>Description</td>
             <td>length(bytes)</td>
        </tr>
    </thead>
    <tbody>
         <tr>
             <td>Header</td>
             <td>装有控制信息</td>
             <td>5</td>
         </tr>
         <tr>
             <td>Payload</td>
             <td>装有用户数据或其他管理信息</td>
             <td>48</td>
         </tr>
    </tbody>
</table>


>  **历史背景：**
    在开发ADSL 技术时，通讯业界比较看好ATM 技术，各运营商也在ATM 相关的设备上投入了很多资金。这种情况下，如果使用信元来传输数据，就比较容易和其他设备进行整合，可以降低开发投入和设备投入。所以如果不是出于这样的原因，其实不需要将包拆分成信元，实际上也有一些ADSL 运营商使用的ADSL Modem 是不进行数据拆分的。


##### 什么是调制
ADSL Modem 内将数字信号转换为电信号（反之亦然）的技术被称之为调制。

##### 为何在ADSL 中要使用调制的方式来将数字信号转换为模拟信号
在以太网中我们知道，数字信号也转换成了模拟信号，它使用了一种简单的方形波表示0和1。为什么在ADSL 技术中我们需要去开发另一个转换技术（调制技术）而不是复用简单的方波信号？

主要有2点考量：
1. 方形波信号容易失真，无法在长距离的场景使用方形波信号的这种转换方式（网线有效距离一般在150m 左右，超过了就不推荐，甚至在华为的一些光转电模块中直接表明网线有效距离不能超过100m）
2. 方形波信号覆盖了从低频到高频的宽广频段，信号频率越高，辐射出来的电磁噪声越强，所以信号频谱太宽就难以控制噪声。


##### 调制技术原理：
ADSL Modem 采用了一种用**圆滑波形（正弦波）** 对信号进行合成来表示0和1的技术，这种技术就是调制。

调制技术有很多方式（例如：Wi-Fi 信号的调制），而ADSL Modem 采用的调制方式是**振幅调制（ASK）** 和**相位调制（PSK）** 相结合的正交振幅调制（QAM，也叫正交调幅）的方式。

**振幅调制（ASK）：** 如下图中(b)，假设振幅小的信号为0，振幅大的信号为1，这是最简单的一种关系。
![](https://cdn.jsdelivr.net/gh/Rayd62/note_images/202203111903218.png)
在上图的例子中，振幅大小只有两个级别。如果增加振幅变化的级别，就可以对应更多的比特。例如，将振幅增加到4个级别，则振幅大小可以表示为00、01、10和11，这样就可以表示2个比特了。这样做可以将单位实际内传输的数据量加倍，也就能够提高速率。


<table>
    <thead>
    <tr>
        <td colspan="2" style="font-weight: bold;text-align: center">理论携带比特</td>
    </tr>
    <tr>
        <td>振幅级别</td>
        <td>代表比特</td>
    </tr>
    </thead>
    <tr>
        <td>2</td>
        <td>1</td>
    </tr>
    <tr>
        <td>4</td>
        <td>2</td>
    </tr>
    <tr>
        <td>8</td>
        <td>3</td>
    </tr>
    <tr>
        <td>16</td>
        <td>4</td>
    </tr>
    <tr>
        <td>X</td>
        <td>2<sup>x</sup></td>
    </tr>
</table>


> 不过信号在传输过程中会发生衰减，也会收到噪声影响而失真，如果振幅级别太多，接收方对信号的识别就容易出错，因此振幅级别需要维持在一个合理的值。



**相位调制（PSK）：** 这是一种根据信号的相位来对应0和1 的方式。
如下图所示，Modem 产生的信号以一定周期振动的波，振动的起始位置不同，波的形状也就不同。
![](https://cdn.jsdelivr.net/gh/Rayd62/note_images/202203111911093.png)
如果将波的一个振动周期理解为一个圆，则起始位置就可以用0 到360 度来表示，这个角度就是相位。例如，0度就是开始的波为0，从180度开始的波为1，这是最简单的一种对应关系。与振幅调制一样，相位调制也可以通过将角度划分为更细的级别来增加对应的比特数量，从而提高速率。当然与振幅调制一样， 太细的划分会造成接收端的误判，因此提升的速率还是有一定限度的。


> 相位(phase)是对于一个波，特定的时刻在它循环中的位置：一种它是否在[波峰](https://baike.baidu.com/item/%E6%B3%A2%E5%B3%B0)、[波谷](https://baike.baidu.com/item/%E6%B3%A2%E8%B0%B7)或它们之间的某点的标度。是描述讯号波形变化的[度量](https://baike.baidu.com/item/%E5%BA%A6%E9%87%8F/34036)，通常以度（角度）作为单位，也称作[相角](https://baike.baidu.com/item/%E7%9B%B8%E8%A7%92)。


**ADSL 的调制方式：** ADSL 的正交振幅调制就是将前面的两种方式组合起来实现的。如下图，如果信号的振幅表示1比特，相位也表示1比特，那么两种方式组合起来，正交振幅调制就可以用一个波表示更多的比特，从而提高传输速率。
![](https://cdn.jsdelivr.net/gh/Rayd62/note_images/202203111916464.png)

##### ADSL 通过多波合成来提高速率
在上一小节中我们描述了一个波（信号）使用正交振幅调制的方法将数字信号转换为电信号的原理。

在实际中，这样的多个波（信号；**注意这里的波是不同频率的波**）可以合成在一起，然后在对端使用滤波器从合成的波中分离出某个特定频率的波（信号），从而在一个传输周期的信号中整合多个信号，将能够表示的比特数成倍提高。

ADSL 利用了这一特质，通过多个波增加能表示的比特数来提高速率。具体来说，ADSL 使用了间隔为4.3125 KHz 的上百个不同频率的波进行合成。

每个波都使用了正交振幅调制技术，且每个波表示的比特数是可变的（噪声小、干扰小的波段分配更多比特）。这样每个频段表示的比特数加起来，就决定了整体的传输速率。

**上行下行速率不同**

| 方向                 | 频段数 | 理论速率 |
| -------------------- | ------ | ---- |
| 上行（用户到互联网） | 26     |   1.3 Mbit/s ([Bins (carrier channels) - wikipedia](https://en.wikipedia.org/wiki/G.992.1))  |
| 下行（互联网到用户） | 95/223 |   8 Mbit/s ([Bins (carrier channels) - wikipedia](https://en.wikipedia.org/wiki/G.992.1))  |


> 一般而言，下行使用的频段较高，这些信号更容易衰减且容易收到噪声的影响。因此这些频段可表示的比特数少，或者干脆无法传输信号。
距离越远，频率越高，这种情况越显著，因此如果用户李电话局太远，速率是无法得到保障的。


正因为噪声和衰减对每个频段的信号影响不同，而且随时都在变化。因此，ADSL 会持续检查信号质量，动态地判断使用的频段数量，以及每个频段分配到的比特数。

具体来说，就是Modem 通电后，会发送测试信号，并且根据信号的接收情况判断使用的频段数量和每个频段的比特数，这个过程被称为训练（握手），需要几秒到几十秒的时间。




##### 调制数据的传输线路和接口是什么样的
线缆：copper telephone lines(铜质电话线)
接口：通用电话线

<table>
    <thead>
        <tr>
            <td>线缆</td>
            <td>接口类型</td>
        </tr>
    </thead>
    <tbody>
        <tr>
            <td rowspan="4">通用电话线</td>
            <td>FXS 接口</td>
        </tr>
        <tr>
            <td>FXO 接口</td>
        </tr>
        <tr>
            <td>ADSL 接口</td>
        </tr>
        <tr>
            <td>VDSL2 接口</td>
        </tr>
    </tbody>
</table>

##### ADSL 噪声控制
虽然电话线和以太网双绞线的内部结构不同，但它们都是金属信号线，所以都会收到来自外部和内部的噪声，导致信号失真。而且，电话线在设计之初并没有考虑ADSL 的高频信号，这样看来电话线比以太网双绞线更容易收到噪声的干扰。

但是与以太网双绞线不同的点在于，双绞线中只有一路方波信号，信号失真就会导致对端无法将电信号还原成原来的数字信号，导致通行错误。而ADSL 信号中是将多路波（信号）合成为一个信号，在多个频段的信号中，只有和噪声频率相同的信号会收到影响而无法读取，即可用的信号频段减少，结果是导致速率下降而非信号错误。

**外部干扰：** 会导致速率下降。常见的外部干扰有：电网线路，AM 电台广播
**内部干扰：** 在四芯线内部（如下图），或者相邻子单元的附近如果同时存在ADSL 和ISDN 线路，ISDN 发出的噪声会干扰ADSL（目前防止ISDN 干扰的技术已经成熟，基本无需担忧ISDN 线路干扰）

![多条信号线捆绑在一起形成电话电缆](https://cdn.jsdelivr.net/gh/Rayd62/note_images/202203131120175.png)


[ADSL - G.992.1(G.dmt) - wikipedia](https://en.wikipedia.org/wiki/G.992.1)

#### 分离器
分离器只在接收对端电信号时产生作用，主要作用有2:
1. 过滤高频的ADSL 信号，将电话信号传给电话终端，保障电话的清晰度（不过滤电话信号，然后发给ADSL Modem 是因为，Modem 中具备过滤ADSL 频率外信号的功能）
2. 防止电话对ADSL 产生干扰：接通电话和断开电话两种状态下，信号的传输方式是不同的。两种状态会导致噪声等线路状态的改变，如果ADSL 通信过程中因为话机导致线路状态变化，就会引起ADSL 重新训练（握手），这样会导致几秒到几十秒的通信中断。
![](https://cdn.jsdelivr.net/gh/Rayd62/note_images/202203112104913.png)


> 在G.992.2 的ADSL 规格中已经有了新技术能够快速训练（握手），即使没有分离器也不会影响ADSL 通信。但是ADSL 的信号依然会影响电话信号，所以分离器是必不可少的一个组件。



## 运营商侧
运营商侧在ADSL 线路连接中可以细分为两大块。
### 电话局
在上图中，电话局位于“用户端电话局”框中，其中包含了：
+ 配线盘
+ 分离器
+ 电话交换机
+ 电话网
+ DSLAM（局端多路Modem）
+ BAS（Broadband Access Server，带宽接入服务器）

#### 各组件功能
##### 配线盘
汇总每家每户电话线，并提供一定的防雷击装置。

##### 分离器
与用户侧分离器功能一致。

##### 电话交换机

##### DSLAM（局端多路Modem）
将模拟信号（电信号）还原成数字信号（信元）。
与用户端的ADSL Modem 功能大致相同，区别在于：
1. 同时连接多条线路，相当于将多个ADSL Modem 的功能集中到一个设备中。增加了空间使用率，并减少了运维管理的难度。
2. DSLAM 一般不具备以太网口，而是ATM 接口。
3. DSLAM 和后方路由器通信使用的是ATM 信元形式而非ADSL Modem 与路由器通信使用的以太网帧形式。

##### BAS（Broadband Access Server）
1. 将 DSLAM 发来的信元转换为原始包；
2. 检查包头的MAC 头部、PPPoE 头部，无误后丢弃；
3. 添加隧道专用头部（一般情况下会使用L2TP 技术，这种情况下会添加L2TP 头部），并发送到隧道出口


### ISP
ISP 为实际连接Internet 的服务机构，在整个为客户提供服务的ADSL 链路中包含了：
+ 路由器（隧道用）
+ 路由器
+ 认证服务器

#### 各组件功能
##### 路由器（隧道用）
接收BAS 传递来的数据包，丢弃隧道头部，将IP 包取出，然后转发到互联网内部。

##### 路由器
互联网内部路由，提供互联网路由服务。



## ADSL 网络数据传输过程
![](https://cdn.jsdelivr.net/gh/Rayd62/note_images/202203111833774.png)
